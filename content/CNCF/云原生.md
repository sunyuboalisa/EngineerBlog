---
title: 云原生
draft: false
tags:
---
 云原生体系结构和技术是一种方法，用于设计、构造和操作在云中构建并充分利用云计算模型的工作负载。

[云原生计算基金会](https://www.cncf.io/)提供了[官方定义](https://github.com/cncf/toc/blob/main/DEFINITION.md)：

> _云原生技术使组织能够在新式动态环境（如公有云、私有云和混合云）中构建和运行可缩放的应用程序。 **容器**、**服务网格**、**微服务**、**不可变基础结构**和**声明性 API** 便是此方法的范例。_

> _这些技术实现了**可复原**、**可管理**且**可观察的**松散耦合系统**。 它们与强大的**自动化**相结合，使工程师能够在尽量减少工作量的情况下，以可预测的方式频繁地进行具有重大影响力的更改。_

云原生是关于速度和**敏捷**性的。 业务系统正在从实现业务功能演变为加快业务速度和增长的战略转型武器。

同时，业务系统也变得越来越复杂，用户要求也越来越高。 他们希望实现快速响应、创新工作和零故障时间。 他们再也无法接受性能问题、反复出现的错误以及不能快速移动。 你的用户将访问你的竞争对手。 云原生系统旨在支持快速更改、大规模操作和复原能力。

云原生基础上包含有**微服务**、**容器**、**服务回滚**、**自动化**等技术。

## 基础设施

DevOps 
- Gitea + Jenkins 
- Azure DevOps

Deploy&服务管理
- K8s 
- Docker

数据库 
- My SQL

缓存
- Redis

消息中间件
- Rocket MQ

监控
- Prometheus + Grafana

包服务器 
- nexus 
- gitlab package repo

服务发现
- Nacos

日志
- ELK
存储 MinIO （可选）


## 微服务开发框架

基于 Spring Cloud Alibaba 2022，Spring Boot 3.x

- 网关 Spring Cloud Gateway 3.x
- 服务注册&发现 Nacos 
- 定时任务 xxl-job
- 资源授权  基于OAuth2.0 

## Scrum开发流程

1. 需求及排期
根据业务方向，选取适合的开发人员，开发和需求一起预估开发时间，进行一个初步的排期。
2. 创建项目
排期后开发人员从DevOps平台创建项目的代码仓库，创建dev、test、prod三个分支，并结合运维人员，添加一些Action，实现 CI/CD 。（如果是微服务环境项目，可以利用Spring Cloud Alibaba 官网去下载需要的项目模版）
3. 开发
进行开发时，先拉取代码，之后在根据自己的工作创建本地分支，以便后续合并至服务器的主分支。创建本地分支根据是新功能还是修改bug，根据自己的工作，创建对应基于dev 的分支。名称基本上就是feature-xxx（新功能）或fixed-xxx（修bug），修改完成后提交合并请求，该请求要经过组长审核，审核通过后合并到服务dev分支，并自动构建、部署至开发服务器。之后同样的步骤将代码合并至服务器test分支，并自动构建部署至test服务器，测试开始在测试环境上测试。测试测完后，开发将代码在同步至服务器prod分支，并自动构建部署至prod服务器。


一些简单的开发规范
分层
- Entity
- DTO
- VO
- Dao
- Service
### 十二要素应用程序

[十二要素应用程序](https://12factor.net/)是一种被广泛认可的用于构建基于云的应用程序的方法。 它介绍了一系列原则和做法，开发人员在构建针对新式云环境进行优化的应用程序时需要遵循这些内容。 其中特别关注了跨环境的可移植性和声明性自动化。

尽管适用于任何基于 Web 的应用程序，不过许多从业人员都将十二要素视为构建云原生应用的坚实基础。 基于这些原则构建的系统可以快速部署和缩放，并添加了功能以快速应对市场变化。

下表重点介绍了十二要素方法：

展开表

|因素|说明|
|---|---|
|1 - 基本代码|每个微服务都有单个基本代码，存储在其自己的存储库中。 它通过版本控制进行跟踪，可以部署到多个环境（QA、暂存、生产）。|
|2 - 依赖项|每个微服务都隔离并打包其自己的依赖项，以在不影响整个系统的情况下进行更改。|
|3 - 配置|配置信息通过代码之外的配置管理工具移出微服务和实现外部化。 在应用了正确配置的情况下，相同部署可以在环境间传播。|
|4 - 支持服务|辅助资源（数据存储、缓存、消息中转站）应通过可寻址 URL 进行公开。 这样做可使资源与应用程序分离，使其可以互换。|
|5 - 生成、发布、运行|每个版本都必须在生成、发布和运行阶段执行严格的分离。 各自都应使用唯一 ID 进行标记，并支持回滚功能。 新式 CI/CD 系统有助于实现此原则。|
|6 - 进程|每个微服务应在其自己的进程中执行，与其他正在运行的服务隔离。 将所需状态外部化到支持服务，如分布式缓存或数据存储。|
|7 - 端口绑定|每个微服务都应是独立的，其接口和功能在自己的端口上公开。 这样做可与其他微服务隔离。|
|8 - 并发|当容量需要增加时，跨多个相同进程（副本）横向扩展服务，而不是在功能最强大的可用计算机上纵向扩展单个大型实例。 将应用程序开发为并发应用程序，从而无缝地在云环境中横向扩展。|
|9 - 可处置性|服务实例应是可处置的。 支持快速启动以增加可伸缩性机会，以及支持正常关闭以使系统保持正确状态。 Docker 容器以及业务流程协调程序本质上满足此要求。|
|10 - 开发/生产等同|使整个应用程序生命周期中的各个环境尽可能相似，避免使用成本高昂的快捷方式。 在这里，通过促进相同的执行环境，容器的采用可以做出很大贡献。|
|11 - 日志记录|将微服务生成的日志视为事件流。 使用事件聚合器处理它们。 将日志数据传播到数据挖掘/日志管理工具（如 Azure Monitor 或 Splunk）并最终传播到长期存档。|
|12 - 管理员进程|以一次性进程形式运行管理性/管理任务，例如数据清理或计算分析。 使用独立工具从生产环境调用这些任务，但独立于应用程序。|
